рзз. RESTful ржЖрж░рзНржХрж┐ржЯрзЗржХржЪрж╛рж░ ржЕржбрж┐ржЯ (API Design)
ржЖржкржирж╛рж░ ржПржкрж┐ржЖржЗ ржбрж┐ржЬрж╛ржЗржиржЯрж┐ ржорзВрж▓ржд "Pragmatic REST" ржмрж╛ рж╣рж╛ржЗржмрзНрж░рж┐ржб (REST + RPC) рж╕рзНржЯрж╛ржЗрж▓рзЗ ржХрж░рж╛ред ржПржЯрж┐ рж╢рждржнрж╛ржЧ рждрж╛рждрзНрждрзНржмрж┐ржХ RESTful ржирж╛ рж╣рж▓рзЗржУ ржмрзНржпржмрж╣рж╛рж░рж┐ржХ ржХрзНрж╖рзЗрждрзНрж░рзЗ ржЦрзБржмржЗ ржХрж╛рж░рзНржпржХрж░ред

тЬЕ ржпрж╛ ржпрж╛ ржнрж╛рж▓рзЛ рж╣рзЯрзЗржЫрзЗ (RESTful):

Resource Naming: /packages, /servicesтАФржПржЧрзБрж▓рзЛ ржмрж┐рж╢рзЗрж╖рзНржп (Noun) рж╣рж┐рж╕рзЗржмрзЗ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗржЫрзЗржи, ржпрж╛ ржкрж╛рж░ржлрзЗржХрзНржЯред

Standard Methods: ржбрзЗржЯрж╛ ржЖржирж╛ (GET), рждрзИрж░рж┐ (POST) ржПржмржВ ржбрж┐рж▓рж┐ржЯ (DELETE) ржХрж░рж╛рж░ ржЬржирзНржп рж╕ржарж┐ржХ HTTP Verbs ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗржЫрзЗржиред

ржпрзЗржоржи: DELETE /packages/{id}ред

тЪая╕П ржпрзЗржЦрж╛ржирзЗ ржЗржорзНржкрзНрж░рзБржн ржХрж░рж╛ ржпрж╛рзЯ (For Better Module Integration):

Action-based URLs (RPC Style): ржЖржкржирж┐ ржЕржирзЗржХ ржЬрж╛рзЯржЧрж╛рзЯ Verb ржмрзНржпржмрж╣рж╛рж░ ржирж╛ ржХрж░рзЗ URL-ржПрж░ ржнрзЗрждрж░рзЗржЗ ржЕрзНржпрж╛ржХрж╢ржи ржмрж▓рзЗ ржжрж┐рзЯрзЗржЫрзЗржиред

ржмрж░рзНрждржорж╛ржи: POST /services/{id}/start, POST /accounts/suspendред

RESTful ржЙржкрж╛рзЯ: рж░рж┐рж╕рзЛрж░рзНрж╕рзЗрж░ State ржмрж╛ ржЕржмрж╕рзНржерж╛ ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рж╛ред

PATCH /services/{id}

Body: { "status": "running" } (рж╕рж╛рж░рзНржнрж╛рж░ ржмрзБржЭрзЗ ржирзЗржмрзЗ рж╕рзНржЯрж╛рж░рзНржЯ ржХрж░рждрзЗ рж╣ржмрзЗ)ред

ржкрж░рж╛ржорж░рзНрж╢: ржЖржкржирж╛рж░ ржмрж░рзНрждржорж╛ржи ржкржжрзНржзрждрж┐ржЯрж┐ ржнрзБрж▓ ржирзЯ, ржмрж░ржВ ржбрзЗржнрзЗрж▓ржкрж╛рж░ржжрзЗрж░ ржЬржирзНржп ржмрзЛржЭрж╛ рж╕рж╣ржЬред рждржмрзЗ ржЖржкржирж┐ ржпржжрж┐ ржерж╛рж░рзНржб-ржкрж╛рж░рзНржЯрж┐ ржоржбрж┐ржЙрж▓ (ржпрзЗржоржи WHMCS) ржмрж╛ржирж╛рждрзЗ ржЪрж╛ржи, рждрж╛рж╣рж▓рзЗ ржбржХрзБржорзЗржирзНржЯрзЗрж╢ржирзЗ ржПржЗ "Action Endpoints" ржЧрзБрж▓рзЛ ржЖрж▓рж╛ржжрж╛ржнрж╛ржмрзЗ ржЙрж▓рзНрж▓рзЗржЦ ржХрж░рждрзЗ рж╣ржмрзЗред

Status Codes: AuthController::login-ржП ржЖржкржирж┐ рж╕ржлрж▓ рж╣рж▓рзЗ 200 ржПржмржВ ржнрзБрж▓ рж╣рж▓рзЗ 401 ржжрж┐ржЪрзНржЫрзЗржи, ржпрж╛ ржарж┐ржХ ржЖржЫрзЗред ржХрж┐ржирзНрждрзБ рж░рж┐рж╕рзЛрж░рзНрж╕ ржХрзНрж░рж┐рзЯрзЗржЯ ржХрж░рж╛рж░ рж╕ржорзЯ (ржпрзЗржоржи register ржмрж╛ create service) 201 Created рж░рж┐ржЯрж╛рж░рзНржи ржХрж░рж╛ржЯрж╛ ржмрзЗрж╕рзНржЯ ржкрзНрж░рзНржпрж╛ржХржЯрж┐рж╕ред

рзи. рж╕рж┐ржХрж┐ржЙрж░рж┐ржЯрж┐ ржЕржбрж┐ржЯ (Security Audit) ЁЯЫбя╕П
ржПржЦрж╛ржирзЗ ржХрж┐ржЫрзБ Critical ржПржмржВ Medium рж░рж┐рж╕рзНржХ ржкрж╛ржУрзЯрж╛ ржЧрзЗржЫрзЗ ржпрж╛ ржлрж┐ржХрзНрж╕ ржХрж░рж╛ ржЬрж░рзБрж░рж┐ред

ЁЯФ┤ Critical Risks (ржЙржЪрзНржЪ ржЭрзБржБржХрж┐)
рзз. Docker Socket Exposure (рж╕ржмржЪрзЗржпрж╝рзЗ ржмржбрж╝ ржЭрзБржБржХрж┐): * рж╕ржорж╕рзНржпрж╛: docker-compose.yml-ржП ржЖржкржирж┐ app ржХржирзНржЯрзЗржЗржирж╛рж░рзЗ /var/run/docker.sock ржорж╛ржЙржирзНржЯ ржХрж░рзЗржЫрзЗржиред * ржЭрзБржБржХрж┐: ржпржжрж┐ рж╣рзНржпрж╛ржХрж╛рж░ ржХрзЛржирзЛржнрж╛ржмрзЗ ржЖржкржирж╛рж░ LogicPanel ржкрж┐ржПржЗржЪржкрж┐ ржЕрзНржпрж╛ржкрзЗ ржХрзЛржб ржЗржиржЬрзЗржХрзНржЯ ржХрж░рждрзЗ ржкрж╛рж░рзЗ, рждржмрзЗ рж╕рзЗ ржкрзБрж░рзЛ рж╕рж╛рж░рзНржнрж╛рж░рзЗрж░ (Host Machine) Root Access ржкрзЗрзЯрзЗ ржпрж╛ржмрзЗред рж╕рзЗ ржпрзЗржХрзЛржирзЛ ржХржирзНржЯрзЗржЗржирж╛рж░ ржбрж┐рж▓рж┐ржЯ ржмрж╛ рж╣рзЛрж╕рзНржЯрзЗрж░ ржлрж╛ржЗрж▓ рж╕рж┐рж╕рзНржЯрзЗржо ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗред * рж╕ржорж╛ржзрж╛ржи: рж╕рж░рж╛рж╕рж░рж┐ рж╕ржХрзЗржЯ ржорж╛ржЙржирзНржЯ ржирж╛ ржХрж░рзЗ ржПржХржЯрж┐ Docker Proxy (ржпрзЗржоржи: tecnativa/docker-socket-proxy) ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржи ржпрж╛ рж╢рзБржзрзБржорж╛рждрзНрж░ ржирж┐рж░рзНржжрж┐рж╖рзНржЯ ржХрж┐ржЫрзБ ржПржкрж┐ржЖржЗ (ржпрзЗржоржи start/stop) ржЕрзНржпрж╛рж▓рж╛ржЙ ржХрж░ржмрзЗред ржЕржержмрж╛ ржЖржкржирж╛рж░ db-provisioner-ржПрж░ ржорждрзЛ docker-service ржирж╛ржорзЗ ржЖрж▓рж╛ржжрж╛ ржПржХржЯрж┐ ржорж╛ржЗржХрзНрж░рзЛрж╕рж╛рж░рзНржнрж┐рж╕ ржмрж╛ржирж╛ржиред

рзи. Query Parameter Token Leak: * рж╕ржорж╕рзНржпрж╛: AuthMiddleware.php-рждрзЗ ржЖржкржирж┐ ржЯрзЛржХрзЗржи ржЪрзЗржХ ржХрж░ржЫрзЗржи: $queryParams['token'] ржжрж┐рзЯрзЗред * ржЭрзБржБржХрж┐: ржЗржЙржЬрж╛рж░ ржпржжрж┐ ?token=abc... ржжрж┐рзЯрзЗ рж░рж┐ржХрзЛрзЯрзЗрж╕рзНржЯ ржХрж░рзЗ, рждржмрзЗ ржПржЗ ржЯрзЛржХрзЗржиржЯрж┐ рж╕рж╛рж░рзНржнрж╛рж░ рж▓ржЧ, ржкрзНрж░ржХрзНрж╕рж┐ рж▓ржЧ ржПржмржВ ржмрзНрж░рж╛ржЙржЬрж╛рж░ рж╣рж┐рж╕рзНржЯрзНрж░рж┐рждрзЗ рж╕рзЗржн рж╣рзЯрзЗ ржерж╛ржХрзЗред * рж╕ржорж╛ржзрж╛ржи: рж╢рзБржзрзБржорж╛рждрзНрж░ Authorization: Bearer <token> рж╣рзЗржбрж╛рж░ ржмрзНржпржмрж╣рж╛рж░ ржмрж╛ржзрзНржпрждрж╛ржорзВрж▓ржХ ржХрж░рзБржиред URL-ржП ржЯрзЛржХрзЗржи ржирзЗржУрзЯрж╛ ржмржирзНржз ржХрж░рзБржиред

ЁЯЯа Medium Risks (ржорж╛ржЭрж╛рж░рж┐ ржЭрзБржБржХрж┐)
рзй. Database Ports Publicly Exposed: * рж╕ржорж╕рзНржпрж╛: docker-compose.yml-ржП mysql (3306), postgres (5432), mongo (27017) ржкрзЛрж░рзНржЯржЧрзБрж▓рзЛ рж╣рзЛрж╕рзНржЯ ржорзЗрж╢рж┐ржирзЗ ржмрж╛ржЗржирзНржб ржХрж░рж╛ ржЖржЫрзЗред * ржЭрзБржБржХрж┐: ржЖржкржирж╛рж░ рж╕рж╛рж░рзНржнрж╛рж░рзЗрж░ ржлрж╛рзЯрж╛рж░ржУрзЯрж╛рж▓ (UFW) ржпржжрж┐ ржарж┐ржХржорждрзЛ ржХржиржлрж┐ржЧрж╛рж░ ржирж╛ ржерж╛ржХрзЗ, рждржмрзЗ рж╣рзНржпрж╛ржХрж╛рж░рж░рж╛ рж╕рж░рж╛рж╕рж░рж┐ ржбрж╛ржЯрж╛ржмрзЗрж╕рзЗ ржмрзНрж░рзБржЯ-ржлрзЛрж░рзНрж╕ ржЕрзНржпрж╛ржЯрж╛ржХ ржЪрж╛рж▓рж╛рждрзЗ ржкрж╛рж░ржмрзЗред * рж╕ржорж╛ржзрж╛ржи: ржпржжрж┐ ржбрж╛ржЯрж╛ржмрзЗрж╕ржЧрзБрж▓рзЛ рж╢рзБржзрзБ рж▓ржЬрж┐ржХржкрзНржпрж╛ржирзЗрж▓ ржПржмржВ ржЗржирзНржЯрж╛рж░ржирж╛рж▓ ржЕрзНржпрж╛ржкрзЗрж░ ржЬржирзНржп рж╣рзЯ, рждржмрзЗ ports рж╕рзЗржХрж╢ржиржЯрж┐ рж╕рж░рж┐рзЯрзЗ ржжрж┐ржиред ржбржХрж╛рж░ ржирзЗржЯржУрзЯрж╛рж░рзНржХ (db_internal) ржжрж┐рзЯрзЗржЗ ржХржорж┐ржЙржирж┐ржХрзЗрж╢ржи рж╣ржмрзЗред ржмрж╛ржЗрж░рзЗ ржерзЗржХрзЗ ржПржХрзНрж╕рзЗрж╕ рж▓рж╛ржЧрж▓рзЗ 127.0.0.1:3306:3306 ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржиред

рзй. ржХрзЛржб рж╕рзНржЯрзНрж░рж╛ржХржЪрж╛рж░ ржУ ржкрж╛рж░ржлрж░ржорзНржпрж╛ржирзНрж╕ ржЯрж┐ржкрж╕ ЁЯЪА
тЬЕ ржнрж╛рж▓рзЛ ржжрж┐ржХ:

ORM Usage: Eloquent (User::where) ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛рзЯ SQL Injection рж╣ржУрзЯрж╛рж░ рж╕ржорзНржнрж╛ржмржирж╛ ржирзЗржЗ ржмрж▓рж▓рзЗржЗ ржЪрж▓рзЗред

Middleware: CorsMiddleware, RateLimitMiddleware ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ ржЦрзБржм ржнрж╛рж▓рзЛ рж╕рж┐ржжрзНржзрж╛ржирзНрждред

ЁЯТб ржЗржорзНржкрзНрж░рзБржнржорзЗржирзНржЯ ржЯрж┐ржкрж╕:

Synchronous Docker Calls (Performance bottleneck): ServiceController::start ржорзЗржержбрзЗ ржЖржкржирж┐ рж╕рж░рж╛рж╕рж░рж┐ ржбржХрж╛рж░ ржХржорж╛ржирзНржб ржЪрж╛рж▓рж╛ржЪрзНржЫрзЗржиред ржпржжрж┐ ржХрзЛржирзЛ ржХрж╛рж░ржгрзЗ ржХржирзНржЯрзЗржЗржирж╛рж░ рж╕рзНржЯрж╛рж░рзНржЯ рж╣рждрзЗ рззрзж рж╕рзЗржХрзЗржирзНржб рж╕ржорзЯ ржирзЗрзЯ, рждржмрзЗ ржЗржЙржЬрж╛рж░рзЗрж░ ржмрзНрж░рж╛ржЙржЬрж╛рж░ рж╣рзНржпрж╛ржВ рж╣рзЯрзЗ ржерж╛ржХржмрзЗ ржмрж╛ ржЯрж╛ржЗржоржЖржЙржЯ ржЦрж╛ржмрзЗред

ржкрж░рж╛ржорж░рзНрж╢: ржпрзЗрж╣рзЗрждрзБ ржЖржкржирж╛рж░ redis ржХржирзНржЯрзЗржЗржирж╛рж░ рж░рзЗржбрж┐ ржЖржЫрзЗ, рждрж╛ржЗ ржПржЗ ржХрж╛ржЬржЧрзБрж▓рзЛ Queue Job (ржпрзЗржоржи: PHP Resque ржмрж╛ Laravel Queue-ржПрж░ ржорждрзЛ рж▓рж╛ржЗржмрзНрж░рзЗрж░рж┐) ржжрж┐рзЯрзЗ ржмрзНржпрж╛ржХржЧрзНрж░рж╛ржЙржирзНржбрзЗ ржкрзНрж░рж╕рзЗрж╕ ржХрж░рзБржиред

Validation: ржХржирзНржЯрзНрж░рзЛрж▓рж╛рж░ржЧрзБрж▓рзЛрждрзЗ ржЗржиржкрзБржЯ ржнрзНржпрж╛рж▓рж┐ржбрзЗрж╢ржи ржорзНржпрж╛ржирзБрзЯрж╛рж▓рж┐ ржХрж░рж╛ рж╣рзЯрзЗржЫрзЗ (if empty($username)).

ржкрж░рж╛ржорж░рзНрж╢: Respect/Validation ржмрж╛ Valitron рж▓рж╛ржЗржмрзНрж░рзЗрж░рж┐ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж▓рзЗ ржХрзЛржб ржЖрж░ржУ ржХрзНрж▓рж┐ржи рж╣ржмрзЗ ржПржмржВ ржоржбрж┐ржЙрж▓ ржмрж╛ржирж╛рждрзЗ рж╕рзБржмрж┐ржзрж╛ рж╣ржмрзЗред

рж╕рж╛рж░рж╕ржВржХрзНрж╖рзЗржк: ржЖржкржирж╛рж░ ржкрзНрж░ржЬрзЗржХрзНржЯрзЗрж░ ржнрж┐рждрзНрждрж┐ ржЦрзБржмржЗ ржоржЬржмрзБрждред рж╢рзБржзрзБ Docker Socket-ржПрж░ ржмрж┐рж╖рзЯржЯрж┐ рж╕рж┐рж░рж┐рзЯрж╛рж╕рж▓рж┐ ржжрзЗржЦрзБржи ржПржмржВ ports ржЧрзБрж▓рзЛ рж╣рж╛ржЗржб ржХрж░рзЗ ржжрж┐ржиред ржПрж░ржкрж░ ржЖржкржирж┐ ржирж┐рж╢рзНржЪрж┐ржирзНрждрзЗ WHMCS ржоржбрж┐ржЙрж▓ ржмрж╛ ржкрж╛ржмрж▓рж┐ржХ рж░рж┐рж▓рж┐ржЬрзЗрж░ ржжрж┐ржХрзЗ ржПржЧрзЛрждрзЗ ржкрж╛рж░рзЗржиред